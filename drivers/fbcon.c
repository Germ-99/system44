#include "../drivers/fb.h"
#include <stddef.h>

typedef struct {
    char ch;
    const char *rows[8];
} fontentry_t;

static const fontentry_t ftable[] = {
    {'A', {"..##....",
           ".#..#...",
           "#....#..",
           "######..",
           "#....#..",
           "#....#..",
           "#....#..",
           "........"}},
    {'B', {"###.....",
           "#..#....",
           "#..#....",
           "###.....",
           "#..#....",
           "#..#....",
           "###.....",
           "........"}},
    {'C', {".###....",
           "#...#...",
           "#.......",
           "#.......",
           "#.......",
           "#...#...",
           ".###....",
           "........"}},
    {'D', {"###.....",
           "#..#....",
           "#...#...",
           "#...#...",
           "#...#...",
           "#..#....",
           "###.....",
           "........"}},
    {'E', {"####....",
           "#.......",
           "#.......",
           "###.....",
           "#.......",
           "#.......",
           "####....",
           "........"}},
    {'F', {"####....",
           "#.......",
           "#.......",
           "###.....",
           "#.......",
           "#.......",
           "#.......",
           "........"}},
    {'G', {".###....",
           "#...#...",
           "#.......",
           "#..##...",
           "#...#..",
           "#...#..",
           ".###....",
           "........"}},
    {'H', {"#...#...",
           "#...#...",
           "#...#...",
           "#####...",
           "#...#...",
           "#...#...",
           "#...#...",
           "........"}},
    {'I', {".###....",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           ".###....",
           "........"}},
    {'J', {"..###...",
           "...#....",
           "...#....",
           "...#....",
           "#..#....",
           "#..#....",
           ".##.....",
           "........"}},
    {'K', {"#...#...",
           "#..#....",
           "#.#.....",
           "##......",
           "#.#.....",
           "#..#....",
           "#...#...",
           "........"}},
    {'L', {"#.......",
           "#.......",
           "#.......",
           "#.......",
           "#.......",
           "#.......",
           "####....",
           "........"}},
    {'M', {"#...#...",
           "##.##...",
           "#.#.#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "........"}},
    {'N', {"#...#...",
           "##..#...",
           "#.#.#...",
           "#..##...",
           "#...#...",
           "#...#...",
           "#...#...",
           "........"}},
    {'O', {".###....",
           "#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           ".###....",
           "........"}},
    {'P', {"###.....",
           "#..#....",
           "#..#....",
           "###.....",
           "#.......",
           "#.......",
           "#.......",
           "........"}},
    {'Q', {".###....",
           "#...#...",
           "#...#...",
           "#...#...",
           "#.#.#...",
           "#..#....",
           ".##.#...",
           "........"}},
    {'R', {"###.....",
           "#..#....",
           "#..#....",
           "###.....",
           "#.#.....",
           "#..#....",
           "#...#...",
           "........"}},
    {'S', {".###....",
           "#...#...",
           "#.......",
           ".###....",
           "....#...",
           "#...#...",
           ".###....",
           "........"}},
    {'T', {"#####...",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           "........"}},
    {'U', {"#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           ".###....",
           "........"}},
    {'V', {"#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           ".#.#....",
           "..#.....",
           "........"}},
    {'W', {"#...#...",
           "#...#...",
           "#...#...",
           "#...#...",
           "#.#.#...",
           "##.##...",
           "#...#...",
           "........"}},
    {'X', {"#...#...",
           "#...#...",
           ".#.#....",
           "..#.....",
           ".#.#....",
           "#...#...",
           "#...#...",
           "........"}},
    {'Y', {"#...#...",
           "#...#...",
           ".#.#....",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           "........"}},
    {'Z', {"#####...",
           "....#...",
           "...#....",
           "..#.....",
           ".#......",
           "#.......",
           "#####...",
           "........"}},
    {'a', {"........",
           "........",
           ".###....",
           "....#...",
           ".####...",
           "#...#...",
           ".####...",
           "........"}},
    {'b', {"#.......",
           "#.......",
           "#.......",
           "###.....",
           "#..#....",
           "#..#....",
           "###.....",
           "........"}},
    {'c', {"........",
           "........",
           ".###....",
           "#.......",
           "#.......",
           "#.......",
           ".###....",
           "........"}},
    {'d', {"...#...",
           "...#...",
           "...#...",
           ".###....",
           "#..#....",
           "#..#....",
           ".###....",
           "........"}},
    {'e', {"........",
           "........",
           ".###....",
           "#...#...",
           "#####...",
           "#.......",
           ".###....",
           "........"}},
    {'f', {"..##....",
           ".#......",
           ".#......",
           "###.....",
           ".#......",
           ".#......",
           ".#......",
           "........"}},
    {'g', {"........",
           "........",
           ".###....",
           "#...#...",
           ".####...",
           "....#...",
           ".###....",
           "........"}},
    {'h', {"#.......",
           "#.......",
           "#.......",
           "###.....",
           "#..#....",
           "#..#....",
           "#..#....",
           "........"}},
    {'i', {"..#.....",
           "........",
           ".##.....",
           "..#.....",
           "..#.....",
           "..#.....",
           ".###....",
           "........"}},
    {'j', {"...#....",
           "........",
           "...#....",
           "...#....",
           "...#....",
           "#..#....",
           ".##.....",
           "........"}},
    {'k', {"#.......",
           "#.......",
           "#..#....",
           "#.#....",
           "##.......",
           "#.#.....",
           "#..#....",
           "........"}},
    {'l', {"##......",
           ".#......",
           ".#......",
           ".#......",
           ".#......",
           ".#......",
           "###.....",
           "........"}},
    {'m', {"........",
           "........",
           "##.#....",
           "#.#.#...",
           "#.#.#...",
           "#...#...",
           "#...#...",
           "........"}},
    {'n', {"........",
           "........",
           "###.....",
           "#..#....",
           "#..#....",
           "#..#....",
           "#..#....",
           "........"}},
    {'o', {"........",
           "........",
           ".###....",
           "#...#...",
           "#...#...",
           "#...#...",
           ".###....",
           "........"}},
    {'p', {"........",
           "........",
           "###.....",
           "#..#....",
           "###.....",
           "#.......",
           "#.......",
           "........"}},
    {'q', {"........",
           "........",
           ".###....",
           "#..#....",
           ".###....",
           "...#....",
           "...#....",
           "........"}},
    {'r', {"........",
           "........",
           "####....",
           "#...#...",
           "#.......",
           "#.......",
           "#.......",
           "........"}},
    {'s', {"........",
           "........",
           ".###....",
           "#.......",
           ".###....",
           "....#...",
           ".###....",
           "........"}},
    {'t', {"..#.....",
           "..#.....",
           "#####...",
           "..#.....",
           "..#.....",
           "..#.....",
           "..#.....",
           "........"}},
    {'u', {"........",
           "........",
           "#..#....",
           "#..#....",
           "#..#....",
           "#..#....",
           ".###....",
           "........"}},
    {'v', {"........",
           "........",
           "#...#...",
           "#...#...",
           "#...#...",
           ".#.#....",
           "..#.....",
           "........"}},
    {'w', {"........",
           "........",
           "#...#...",
           "#...#...",
           "#.#.#...",
           "##.##...",
           "#...#...",
           "........"}},
    {'x', {"........",
           "........",
           "#...#...",
           ".#.#....",
           "..#.....",
           ".#.#....",
           "#...#...",
           "........"}},
    {'y', {"........",
           "........",
           "#...#...",
           "#...#...",
           ".####...",
           "....#...",
           ".###....",
           "........"}},
    {'z', {"........",
           "........",
           "#####...",
           "...#....",
           "..#.....",
           ".#......",
           "#####...",
           "........"}}
};


static const fontentry_t *font_get(char c){
    for(size_t i = 0; i < sizeof(ftable)/sizeof(ftable[0]); i++)
        if(ftable[i].ch == c) return &ftable[i];
    return NULL;
}

void fbcputchar(u16 px, u16 py, char c, u32 color){
    const fontentry_t *f = font_get(c);
    if(!f) return;
    for(u8 y = 0; y < 8; y++){
        const char *r = f->rows[y];
        for(u8 x = 0; x < 8; x++){
            if(r[x] == '#') fb_putpixel(px + x, py + y, color);
        }
    }
}

void fbcstr(u16 px, u16 py, const char *s, u32 color){
    while(*s){
        fbcputchar(px, py, *s, color);
        px += 8;
        s++;
    }
}
