#include "../drivers/fb.h"
#include <stddef.h>

typedef struct {
    char ch;
    const char *rows[8];
} fontentry_t;

static const fontentry_t ftable[] = {
    {'A', {".##.", "#..#", "#..#", "####", "#..#", "#..#", "#..#", "...."}},
    {'B', {"###.", "#..#", "###.", "#..#", "#..#", "#..#", "###.", "...."}},
    {'C', {".##.", "#..#", "#...", "#...", "#...", "#..#", ".##.", "...."}},
    {'D', {"###.", "#..#", "#..#", "#..#", "#..#", "#..#", "###.", "...."}},
    {'E', {"####", "#...", "###.", "#...", "#...", "#...", "####", "...."}},
    {'F', {"####", "#...", "###.", "#...", "#...", "#...", "#...", "...."}},
    {'G', {".##.", "#..#", "#...", "#.##", "#..#", "#..#", ".###", "...."}},
    {'H', {"#..#", "#..#", "#..#", "####", "#..#", "#..#", "#..#", "...."}},
    {'I', {".###", "..#.", "..#.", "..#.", "..#.", "..#.", ".###", "...."}},
    {'J', {"..##", "...#", "...#", "...#", "...#", "#..#", ".##.", "...."}},
    {'K', {"#..#", "#.#.", "##..", "#...", "##..", "#.#.", "#..#", "...."}},
    {'L', {"#...", "#...", "#...", "#...", "#...", "#...", "####", "...."}},
    {'M', {"#...#", "##.##", "#.#.#", "#...#", "#...#", "#...#", "#...#", "...."}},
    {'N', {"#..#", "##.#", "#.#.", "#..#", "#..#", "#..#", "#..#", "...."}},
    {'O', {".##.", "#..#", "#..#", "#..#", "#..#", "#..#", ".##.", "...."}},
    {'P', {"###.", "#..#", "#..#", "###.", "#...", "#...", "#...", "...."}},
    {'Q', {".##.", "#..#", "#..#", "#..#", "#.#.", "#..#", ".###", "...."}},
    {'R', {"###.", "#..#", "#..#", "###.", "##..", "#.#.", "#..#", "...."}},
    {'S', {".###", "#...", "#...", ".##.", "...#", "...#", "###.", "...."}},
    {'T', {"####", "..#.", "..#.", "..#.", "..#.", "..#.", "..#.", "...."}},
    {'U', {"#..#", "#..#", "#..#", "#..#", "#..#", "#..#", ".##.", "...."}},
    {'V', {"#..#", "#..#", "#..#", "#..#", "#..#", ".##.", ".##.", "...."}},
    {'W', {"#...#", "#...#", "#...#", "#.#.#", "#.#.#", "#.#.#", ".#.#.", "...."}},
    {'X', {"#..#", "#..#", ".##.", ".##.", ".##.", "#..#", "#..#", "...."}},
    {'Y', {"#...#", "#...#", ".#.#.", "..#..", "..#..", "..#..", "..#..", "...."}},
    {'Z', {"####", "...#", "..#.", ".#..", "#...", "#...", "####", "...."}},
};

static const fontentry_t *font_get(char c){
    for(size_t i=0;i<sizeof(ftable)/sizeof(ftable[0]);i++)
        if(ftable[i].ch==c)return &ftable[i];
    return NULL;
}

static void fbcputchar(u16 px,u16 py,char c,u32 color){
    const fontentry_t *f=font_get(c);
    if(!f)return;
    for(u8 y=0;y<8;y++){
        const char *r=f->rows[y];
        for(u8 x=0;x<4;x++)
            if(r[x]=='#')fb_putpixel(px+x,py+y,color);
    }
}

static void fbcstr(u16 px,u16 py,const char *s,u32 color){
    while(*s){fbcputchar(px,py,*s,color);px+=5;s++;}
}

void kmain(u8 *vbe){
    fb_init(vbe);
    fb_fill(0x0000FF);
    fbcstr(10,10,"Y",0xFF5768);
    fbcstr(17,10,"A",0xFFBF65);
    fbcstr(24,10,"R",0x00B0BA);
    fbcstr(31,10,"A",0x6C88C4);
    fbcstr(38,10,"K",0x0065A2);
    fbcstr(45,10,"H",0x6A5ACD);
    fbcstr(52,10,"A",0x8A2BE2);
    fbcstr(59,10,"L",0x800080);
    fbcstr(66,10,"O",0x4B0082);
    for(;;);
}
