#include "../drivers/fb.h"
#include <stddef.h>

typedef struct {
    char ch;
    const char *rows[8];
} fontentry_t;

static const fontentry_t ftable[] = {
    {'A', {".##.", "#..#", "#..#", "####", "#..#", "#..#", "#..#", "...."}},
    {'B', {"###.", "#..#", "###.", "#..#", "#..#", "#..#", "###.", "...."}},
    {'C', {".##.", "#..#", "#...", "#...", "#...", "#..#", ".##.", "...."}},
    {'D', {"###.", "#..#", "#..#", "#..#", "#..#", "#..#", "###.", "...."}},
    {'E', {"####", "#...", "###.", "#...", "#...", "#...", "####", "...."}},
    {'F', {"####", "#...", "###.", "#...", "#...", "#...", "#...", "...."}},
    {'G', {".##.", "#..#", "#...", "#.##", "#..#", "#..#", ".###", "...."}},
    {'H', {"#..#", "#..#", "#..#", "####", "#..#", "#..#", "#..#", "...."}},
    {'I', {".###", "..#.", "..#.", "..#.", "..#.", "..#.", ".###", "...."}},
    {'J', {"..##", "...#", "...#", "...#", "...#", "#..#", ".##.", "...."}},
    {'K', {"#..#", "#.#.", "##..", "#...", "##..", "#.#.", "#..#", "...."}},
    {'L', {"#...", "#...", "#...", "#...", "#...", "#...", "####", "...."}},
    {'M', {"#..#", "####", "####", "#..#", "#..#", "#..#", "#..#", "...."}},
    {'N', {"#..#", "##.#", "#.#.", "#..#", "#..#", "#..#", "#..#", "...."}},
    {'O', {".##.", "#..#", "#..#", "#..#", "#..#", "#..#", ".##.", "...."}},
    {'P', {"###.", "#..#", "#..#", "###.", "#...", "#...", "#...", "...."}},
    {'Q', {".##.", "#..#", "#..#", "#..#", "#.#.", "#..#", ".###", "...."}},
    {'R', {"###.", "#..#", "#..#", "###.", "##..", "#.#.", "#..#", "...."}},
    {'S', {".###", "#...", "#...", ".##.", "...#", "...#", "###.", "...."}},
    {'T', {"####", "..#.", "..#.", "..#.", "..#.", "..#.", "..#.", "...."}},
    {'U', {"#..#", "#..#", "#..#", "#..#", "#..#", "#..#", ".##.", "...."}},
    {'V', {"#..#", "#..#", "#..#", "#..#", "#..#", ".##.", ".##.", "...."}},
    {'W', {"#..#", "#..#", "#..#", "#..#", "#..#", "####", "#..#", "...."}},
    {'X', {"#..#", "#..#", ".##.", ".##.", ".##.", "#..#", "#..#", "...."}},
    {'Y', {"#..#", "#..#", ".##.", "..#.", "..#.", "..#.", "..#.", "...."}},
    {'Z', {"####", "...#", "..#.", ".#..", "#...", "#...", "####", "...."}},
    {'0', {".##.", "#..#", "#.##", "##.#", "#..#", "#..#", ".##.", "...."}},
    {'1', {"..#.", ".##.", "..#.", "..#.", "..#.", "..#.", ".###", "...."}},
    {'2', {".##.", "#..#", "...#", "..#.", ".#..", "#...", "####", "...."}},
    {'3', {"###.", "...#", "..#.", ".##.", "...#", "#..#", ".##.", "...."}},
    {'4', {"#..#", "#..#", "#..#", "####", "...#", "...#", "...#", "...."}},
    {'5', {"####", "#...", "###.", "...#", "...#", "#..#", ".##.", "...."}},
    {'6', {".##.", "#...", "###.", "#..#", "#..#", "#..#", ".##.", "...."}},
    {'7', {"####", "...#", "..#.", ".#..", ".#..", ".#..", ".#..", "...."}},
    {'8', {".##.", "#..#", "#..#", ".##.", "#..#", "#..#", ".##.", "...."}},
    {'9', {".##.", "#..#", "#..#", ".###", "...#", "#..#", ".##.", "...."}},
    {'.', {"....", "....", "....", "....", "....", ".##.", ".##.", "...."}},
    {',', {"....", "....", "....", "....", "....", ".##.", "..#.", ".#.."}},
    {':', {"....", "....", ".##.", ".##.", "....", ".##.", ".##.", "...."}},
    {';', {"....", "....", ".##.", ".##.", "....", ".##.", "..#.", ".#.."}},
    {'!', {"..#.", "..#.", "..#.", "..#.", "..#.", "....", "..#.", "...."}},
    {'?', {".##.", "#..#", "...#", "..#.", ".#..", "....", ".#..", "...."}},
    {'-', {"....", "....", "....", "####", "....", "....", "....", "...."}},
    {'+', {"....", "..#.", "..#.", "####", "..#.", "..#.", "....", "...."}},
    {'*', {"#.#.", ".#.#", "####", ".#.#", "#.#.", "....", "....", "...."}},
    {'/', {"...#", "...#", "..#.", ".#..", "#...", "#...", "....", "...."}},
    {'=', {"....", "####", "....", "####", "....", "....", "....", "...."}},
    {'(', {"..#.", ".#..", "#...", "#...", "#...", ".#..", "..#.", "...."}},
    {')', {"#...", ".#..", "..#.", "..#.", "..#.", ".#..", "#...", "...."}},
    {'[', {"###.", "#...", "#...", "#...", "#...", "#...", "###.", "...."}},
    {']', {"###.", "...#", "...#", "...#", "...#", "...#", "###.", "...."}},
    {'_', {"....", "....", "....", "....", "....", "....", "####", "...."}},
    {'"', {"#.#.", "#.#.", "....", "....", "....", "....", "....", "...."}},
    {'\'', {"..#.", "..#.", "....", "....", "....", "....", "....", "...."}},
    {'#', {".#.#", "####", ".#.#", "####", ".#.#", "....", "....", "...."}},
    {'@', {".##.", "#..#", "#.##", "#.#.", "#.##", "#...", ".###", "...."}},
    {'%', {"##..", "##.#", "...#", "..#.", ".#..", "#.##", "#..#", "...."}},
};

static const fontentry_t *font_get(char c){
    for(size_t i=0;i<sizeof(ftable)/sizeof(ftable[0]);i++)
        if(ftable[i].ch==c)return &ftable[i];
    return NULL;
}

static void fbcputchar(u16 px,u16 py,char c,u32 color){
    const fontentry_t *f=font_get(c);
    if(!f)return;
    for(u8 y=0;y<8;y++){
        const char *r=f->rows[y];
        for(u8 x=0;x<4;x++)
            if(r[x]=='#')fb_putpixel(px+x,py+y,color);
    }
}

static void fbcstr(u16 px,u16 py,const char *s,u32 color){
    while(*s){fbcputchar(px,py,*s,color);px+=5;s++;}
}

void kmain(u8 *vbe){
    fb_init(vbe);
    fb_fill(0x0000FF);
    fbcstr(10,40,"WAR IS PEACE", 0xFFFFFFFF);
    fbcstr(10,48,"FREEDOM IS SLAVERY", 0xFFFFFFFF);
    fbcstr(10,56,"IGNORANCE IS STRENGTH", 0xFFFFFFFF);
    fbcstr(10,10,"// SYSTEM44 (2.07 X86 10/10/2025) // ",0xFFFFFF);
    for(;;);
}
